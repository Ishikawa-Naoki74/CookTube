# 動画解析対応の追加要件

## 1. FFmpegのインストール（必須）

### macOS
```bash
brew install ffmpeg
```

### Ubuntu/Debian
```bash
sudo apt update
sudo apt install ffmpeg
```

### Windows
1. https://ffmpeg.org/download.html からダウンロード
2. PATHに追加

## 2. 追加パッケージのインストール

```bash
cd cooktube-api
npm install fluent-ffmpeg @types/fluent-ffmpeg
```

## 3. 動画処理の新しい流れ

### 従来の処理
```
YouTube URL → 音声抽出 → Transcribe → サムネイル解析 → レシピ生成
```

### 強化された処理
```
YouTube URL → 動画ダウンロード → フレーム抽出 → Rekognition Video → 音声抽出 → Transcribe → 統合解析 → 詳細レシピ生成
```

## 4. 改善点

### 🎯 動画解析の精度向上
- **サムネイルのみ** → **動画全体を解析**
- 10秒ごとのキーフレーム抽出
- シーン変化検出による重要な場面の特定
- タイムスタンプ付きで食材・器具・動作を検出

### 📊 より詳細な情報抽出
- **食材の登場タイミング**
- **調理器具の使用タイミング**  
- **調理動作の時系列分析**
- **音声と映像の統合分析**

### 🤖 AI生成レシピの高度化
- タイムスタンプ付きの詳細手順
- 各工程で使用する食材・器具を明記
- 調理技術の分類
- 難易度の自動判定

## 5. API使用量の注意

### Rekognition Video
- 動画1分あたり約$0.10
- 10分動画 = 約$1.00

### Transcribe
- 音声1分あたり約$0.024  
- 10分動画 = 約$0.24

### Bedrock (Claude)
- 入力トークン1000個あたり約$0.003
- 長いプロンプト = 約$0.01-0.05

**合計: 10分動画で約$1.30程度**

## 6. パフォーマンス最適化

- 動画解像度を720p以下に制限
- フレーム抽出数を最大30枚に制限
- 並列処理による処理時間の短縮
- 一時ファイルの自動クリーンアップ

## 7. エラーハンドリング

- ネットワーク障害時のリトライ
- AWSサービス障害時のフォールバック
- 動画ダウンロード失敗時の代替処理
- 部分的な解析失敗時の継続処理